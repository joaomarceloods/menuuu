<%= content_for :navigation_bar do %>
  <%= link_to private_menus_path do %>
    <span class="material-symbols-sharp">arrow_back_ios</span>
    Menus
  <% end %>

<% end %>

<%= content_for :navigation_menu do %>
  <% if @menu.published? %>
    <%= link_to public_menu_path(@menu), target: :_blank do %>
      <span class="material-symbols-sharp">open_in_new</span>
      &nbsp;
       View as customer
    <% end %>
  <% end %>

  <% if @menu.published? %>
    <%= button_to "Unpublish",
          private_menu_path(@menu),
          method: :put,
          params: { menu: { published: 0 } },
          data: { turbo_confirm: "Unpublish this menu? Customers won't be able to view it anymore." } %>
  <% else %>
    <%= button_to "Publish",
          private_menu_path(@menu),
          method: :put,
          params: { menu: { published: 1 } },
          data: { turbo_confirm: "Publish this menu? It will become visible to customers." } %>
  <% end %>

  <%= button_to "Delete",
        private_menu_path(@menu),
        method: :delete,
        data: { turbo_confirm: "Delete this menu? Once deleted, it can't be restored. If you just want to hide it from customers, you can unpublish instead." } %>

<% end %>

<div class="menu minimalist">

  <%= turbo_frame_tag :edit, class: "menu-content" do %>
    <div class="menu-section">
      <%= form_for @menu, url: [:private, @menu], html: { oninput: "this.requestSubmit()" } do |f| %>
        <%= f.text_field :name, placeholder: "Menu Name", autocomplete: :off, class: "menu-name indistinct-input" %>
      <% end %>
    </div>
  <% end %>

  <%= tag.div class: "menu-content" do %>
    <div class="menu-section">
      <%= button_to \
            "Add section",
            private_menu_sections_path,
            class: "large button",
            data: { turbo_frame: :list },
            params: { menu_section: { menu_id: @menu.id, position: 1 } } %>
    </div>
  <% end %>

  <%= turbo_frame_tag :list, data: { controller: "sortable-menu-sections" } do %>
    <% @menu.menu_sections.order(:position).each do |menu_section| %>
      <%= turbo_frame_tag menu_section, class: "menu-content", data: { sortable_menu_sections_update_url: private_menu_section_path(menu_section) } do %>
        <div class="menu-section">
          <%= render "private/menu_sections/form", menu_section: menu_section %>

          <%= tag.div data: { controller: "sortable-menu-items", sortable_menu_items_menu_section_id: menu_section.id } do %>
            <% menu_section.menu_items.order(:position).each do |menu_item| %>
              <%= render "private/menu_items/form", menu_item: menu_item %>
            <% end %>
          <% end %>
        </div>

        <div class="menu-section">
          <%= button_to \
                "Add section",
                private_menu_sections_path,
                class: "large button",
                data: { turbo_frame: :list },
                params: { menu_section: { menu_id: @menu.id, position: menu_section.position + 1 } } %>
        </div>
      <% end %>
    <% end %>
  <% end %>

</div>
